<!DOCTYPE html>
<html lang="fr">
<head>
  <link rel="manifest" href="manifest.json">
<link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
<link rel="apple-touch-icon" href="icon-512.png">
<meta name="theme-color" content="#3498db">
<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('service-worker.js')
      .then(() => console.log("‚úÖ Service Worker enregistr√©"))
      .catch(e => console.error("‚ùå Service Worker √©chec:", e));
  }
</script>

  <meta charset="UTF-8">
  <title>M√©taMusique</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: system-ui, sans-serif;
      max-width: 800px;
      margin: 2rem auto;
      padding: 1rem;
      background-color: #f8f9fa;
      color: #222;
    }
    h1, h2, h3 {
      color: #444;
    }
    input[type="text"] {
      width: 100%;
      padding: 0.5rem;
      font-size: 1rem;
      margin-bottom: 1rem;
    }
    button {
      padding: 0.5rem 1rem;
      font-size: 1rem;
      background-color: #007acc;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    button:hover {
      background-color: #005fa3;
    }
    ul {
      list-style-type: none;
      padding-left: 0;
    }
    li {
      margin: 0.5rem 0;
    }
    a {
      color: #007acc;
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }
    img {
      margin-top: 0.5rem;
      max-height: 80px;
    }
    .section {
      margin-top: 2rem;
    }
  </style>
</head>
<body>
  <h1>üéµ M√©taMusique</h1>
  <p>Recherchez une chanson ou ≈ìuvre musicale pour acc√©der √† ses ressources l√©gales : partitions, accords, paroles.</p>

  <input type="text" id="songTitle" placeholder="Ex : Imagine, Bella Ciao, Clair de lune‚Ä¶">
  <button onclick="generateLinks()">Rechercher</button>

  <div id="results" class="section"></div>
  <div id="history" class="section"></div>

  <script>
    function generateLinks() {
      const title = document.getElementById("songTitle").value.trim();
      if (!title) return;
      saveToHistory(title);

      const q = encodeURIComponent(title);
      const sections = {
        "üéº Partitions": {
          "IMSLP (classique, domaine public)": `https://www.google.com/search?q=${q}+site:imslp.org`,
          "MuseScore (communaut√©)": `https://www.google.com/search?q=${q}+site:musescore.com`,
          "8notes (multi-instruments)": `https://www.google.com/search?q=${q}+site:8notes.com`,
          "Free-scores.com": `https://www.google.com/search?q=${q}+site:free-scores.com`
        },
        "üé∏ Accords / Tablatures": {
          "Ultimate Guitar": `https://www.google.com/search?q=${q}+site:ultimate-guitar.com`,
          "La Bo√Æte √† Chansons": `https://www.google.com/search?q=${q}+site:la-boite-a-chansons.fr`,
          "GuitareTab": `https://www.google.com/search?q=${q}+site:guitaretab.com`,
          "Chordify": `https://www.google.com/search?q=${q}+site:chordify.net`
        },
        "üé§ Paroles": {
          "Paroles.net": `https://www.google.com/search?q=${q}+site:paroles.net`,
          "Genius": `https://www.google.com/search?q=${q}+site:genius.com`,
          "Lyrics.com": `https://www.google.com/search?q=${q}+site:lyrics.com`,
          "LyricsTranslate": `https://www.google.com/search?q=${q}+site:lyricstranslate.com`
        },
        "üñºÔ∏è Aper√ßu image (partitions)": {
          "Google Images": `https://www.google.com/search?tbm=isch&q=${q}+partition`
        }
      };

      let html = `<h2>R√©sultats pour : "<em>${title}</em>"</h2>`;
      for (const [section, links] of Object.entries(sections)) {
        html += `<div class="section"><h3>${section}</h3><ul>`;
        for (const [name, url] of Object.entries(links)) {
          if (section.includes("Aper√ßu")) {
            html += `<li><a href="${url}" target="_blank">
              <img src="https://www.google.com/s2/favicons?domain=google.com" alt="aper√ßu image">
              ${name}
            </a></li>`;
          } else {
            html += `<li><a href="${url}" target="_blank">${name}</a></li>`;
          }
        }
        html += `</ul></div>`;
      }

      document.getElementById("results").innerHTML = html;
    }

    function saveToHistory(title) {
      let history = JSON.parse(localStorage.getItem("searchHistory") || "[]");
      if (!history.includes(title)) {
        history.unshift(title);
        history = history.slice(0, 10);
        localStorage.setItem("searchHistory", JSON.stringify(history));
        renderHistory();
      }
    }

    function renderHistory() {
      const container = document.getElementById("history");
      const history = JSON.parse(localStorage.getItem("searchHistory") || "[]");
      if (history.length === 0) {
        container.innerHTML = "<p>Aucune recherche r√©cente</p>";
        return;
      }
      container.innerHTML = "<h3>Recherches r√©centes</h3>";
      history.forEach(title => {
        const link = document.createElement("a");
        link.href = "#";
        link.innerText = title;
        link.onclick = () => {
          document.getElementById("songTitle").value = title;
          generateLinks();
        };
        container.appendChild(link);
        container.appendChild(document.createElement("br"));
      });
    }

    window.onload = renderHistory;
  </script>
</body>
</html>
