<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>NOTA</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="apple-touch-icon" sizes="180x180" href="icons/icon-180.png" />
  <link rel="icon" type="image/png" sizes="48x48" href="icons/icon-48.png" />
  <link rel="manifest" href="manifest.webmanifest" />
  <meta name="theme-color" content="#3498db" />
  <style>
    body { font-family: Arial,sans-serif; padding:2em; margin:0; background:#f4f4f4; color:#333; }
    input,button { width:100%;max-width:500px;padding:0.7em;margin:0.5em 0; }
    button { background:#3498db;color:#fff;border:none;cursor:pointer; }
    button:hover { background:#2980b9; }
    .results { margin-top:2em;background:#fff;padding:1em;border-radius:8px; }
    .category { margin-top:1em; }
    a { display:block;margin:5px 0;color:#3498db;text-decoration:none; }
    .thumbnails { display:flex;flex-wrap:wrap;gap:8px;margin:8px 0; }
    .thumbnails img { width:100px;height:100px;object-fit:cover;border-radius:4px; }
    .status { font-style:italic;color:#555; }
  </style>
</head>
<body>

<h1>üéº NOTA</h1>
<p>Recherche partitions, tablatures, paroles et aper√ßu visuel</p>
<input type="text" id="songTitle" placeholder="Ex: Imagine de John Lennon">
<button onclick="generateLinks()">üîç Rechercher</button>
<p class="status" id="status"></p>
<div id="results" class="results" style="display:none;"></div>

<script>
  async function fetchThumbnails(query) {
    const url = 'https://corsproxy.io/?' + encodeURIComponent(`https://www.bing.com/images/search?q=${encodeURIComponent(query+' partition')}`);
    try {
      const resp = await fetch(url);
      const text = await resp.text();
      const srcs = [...text.matchAll(/<img[^>]+src="([^"]+)"/g)].slice(0,4).map(m=>m[1]);
      return srcs;
    } catch (e) {
      console.warn("Miniatures Bing √©chou√©es", e);
      return [];
    }
  }

  async function generateLinks() {
    const title = document.getElementById('songTitle').value.trim();
    const status = document.getElementById('status');
    const results = document.getElementById('results');

    if(!title) { alert("Veuillez saisir un titre"); return; }
    status.textContent = "üîÑ Chargement‚Ä¶";
    results.style.display = 'block';
    results.innerHTML = "";

    const enc = encodeURIComponent(title);
    const thumbs = await fetchThumbnails(title);

    let html = `<h2>R√©sultats pour ¬´¬†${title}¬†¬ª</h2>`;

    // Partitions / accords
    html += `<div class="category"><strong>Partitions / Accords</strong>`;
    [
      ['IMSLP', `https://imslp.org/wiki/Special:Search/${enc}`],
      ['MuseScore', `https://musescore.com/sheetmusic?text=${enc}`],
      ['Free-scores.com', `https://www.free-scores.com/recherche-partitions.php?search=${enc}`],
      ['Ultimate Guitar', `https://www.ultimate-guitar.com/search.php?search_type=title&value=${enc}`]
    ].forEach(([label, url]) => {
      html += `<a href="${url}" target="_blank">${label}</a>`;
    });
    html += `</div>`;

    // Paroles
    html += `<div class="category"><strong>Paroles</strong>`;
    [
      ['Genius', `https://genius.com/search?q=${enc}`],
      ['Paroles.net', `https://www.paroles.net/recherche?q=${enc}`]
    ].forEach(([label, url]) => {
      html += `<a href="${url}" target="_blank">${label}</a>`;
    });
    html += `</div>`;

    // Thumbnails
    html += `<div class="category"><strong>Aper√ßu visuel (Bing)</strong>`;
    if (thumbs.length) {
      html += `<div class="thumbnails">` +
        thumbs.map(src => `<a href="https://www.bing.com/images/search?q=${enc}+partition" target="_blank"><img src="${src}" loading="lazy"></a>`).join('') +
        `</div>`;
    }
    html += `<a href="https://www.google.com/search?tbm=isch&q=${enc}+partition" target="_blank">Voir plus sur Google Images</a>`;
    html += `</div>`;

    results.innerHTML = html;
    status.textContent = "‚úÖ Termin√©";
  }
</script>

</body>
</html>
